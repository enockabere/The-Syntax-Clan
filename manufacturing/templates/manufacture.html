{% extends 'base.html' %}
{% load static %}
{% block base %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="{% static 'plugins/Moment/moment.js' %}"></script>
<link rel="stylesheet"
    href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
<section class="section">
    <div class="section-header">
        <h1>Manufacturing License Application Form</h1>
        <div class="section-header-breadcrumb">
            <div class="breadcrumb-item active"><a href="{% url 'dashboard' %}">Dashboard</a></div>
            <div class="breadcrumb-item"><a href="#">New Application</a></div>
            <div class="breadcrumb-item">New Applications</div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            {% include 'alert.html' %}
            <div class="card mt-2">
                <div class="card-body">
                    <!-- Bordered Tabs Justified -->
                    <form id="regForm" class="bg-white p-4" method="post" novalidate>
                        {% csrf_token %}
                        <input type="hidden" name="manufacturingNo" id="manufacturingNo" value="">
                        <input type="hidden" name="myAction" id="myAction" value="insert">
                        <div class="border border-success rounded p-3 my-3">
                            <p class="text-small text-primary">Supervising Veterinary Surgeon's' Information</p>
                            <div class="row my-3">
                                <div class="col-md-4">
                                    <label class="form-label">Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="name" id="name">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Professional RegNo <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="professionalRegNo"
                                        id="professionalRegNo">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Email<span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" name="email" id="email">
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">Cell Phone <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" name="cellPhone" id="cellPhone">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">ID/Passport/Alien ID No <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="iDorPassportOrAlienIDNo"
                                        id="iDorPassportOrAlienIDNo">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Nationality <span class="text-danger">*</span></label>
                                    <select class="form-control" aria-label="Default select example" name="nationality"
                                        id="nationality">
                                        <option selected value="">Choose...</option>
                                        {% for res in country %}
                                        <option value="{{res.Code}}">{{res.Name}}</option>
                                        {% empty %}
                                        <option value="KE">KENYA</option>
                                        {% endfor %}
                                    </select>

                                </div>
                            </div>
                        </div>
                        <div class="border border-success rounded p-3  my-3">
                            <p class="text-small text-primary">Direct Personal Supervisor Information</p>
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="form-label">Supervisor Name<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="directPersonalSupervisor"
                                        id="directPersonalSupervisor">
                                </div>
                            </div>
                            <div class="row my-2">
                                <div class="col-md-12">
                                    <label class="form-label">Supervisor Qualifications <span
                                            class="text-danger">*</span></label>
                                    <textarea type="text" class="form-control" name="supervisorQualifications"
                                        id="supervisorQualifications"></textarea>
                                </div>
                            </div>
                            <div class="row my-2">
                                <div class="col-md-12">
                                    <label class="form-label">Plot No</label>
                                    <input type="text" class="form-control" name="plotNo" id="plotNo">
                                </div>
                            </div>
                            <div class="row my-2">
                                <div class="col-md-12">
                                    <div class="mb-2">
                                        <div class="form-group">
                                            <label class="custom-switch mt-2">
                                                <input type="checkbox" value="True" name="iAgree" id="iAgree"
                                                    class="custom-switch-input" checked>
                                                <span class="custom-switch-indicator"></span>
                                                <span class="custom-switch-description">
                                                    I hereby apply for a manufacturing license and
                                                    declare that all the information herein is correct
                                                    and true.
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="money-spinner mx-auto text-center" id="spinner0" style="display: none;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif"
                                alt="Loading Gif" style="height: 70px; width: 100px;" class="img-fluid">
                        </div>
                        <button type="submit" class="btn btn-primary my-3 w-100">Save Application</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    const $headerForm = $('#regForm');

    $(document).ready(function () {
        $headerForm.on('submit', (e) => {
            e.preventDefault();
            $('#spinner0').show();
            $.ajax({
                type: 'POST',
                url: '/selfservice/ManufacturingLicense/',
                data: {
                    manufacturingNo: $("#manufacturingNo").val(),
                    directPersonalSupervisor: $("#directPersonalSupervisor").val(),
                    supervisorQualifications: $("#supervisorQualifications").val(),
                    iAgree: $('#iAgree').val(),
                    plotNo: $('#plotNo').val(),
                    myAction: $("#myAction").val(),
                    name: $('#name').val(),
                    professionalRegNo: $('#professionalRegNo').val(),
                    email: $('#email').val(),
                    cellPhone: $('#cellPhone').val(),
                    iDorPassportOrAlienIDNo: $('#iDorPassportOrAlienIDNo').val(),
                    nationality: $('#nationality').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (response) {
                    if (response['response']) {
                        window.location.href = "/selfservice/ManufacturingLicense/" +
                            response[
                                'response'] + "/";
                        iziToast.show({
                            theme: 'dark',
                            backgroundColor: '#0974bd',
                            icon: 'las la-check-circle',
                            title: response['response'] +
                                " " +
                                "created successfully",
                            position: 'topRight',
                            progressBarColor: '#F4F6F7',
                        });
                        $('#supervisorQualifications, #directPersonalSupervisor, #name, #professionalRegNo')
                            .val(
                                '');
                        $('#email, #cellPhone, #iDorPassportOrAlienIDNo, #nationality')
                            .val(
                                '');
                    } else if (response['error']) {
                        iziToast.show({
                            theme: 'dark',
                            icon: 'las la-exclamation',
                            title: 'Error',
                            message: response['error'],
                            position: 'topRight',
                            progressBarColor: '#ff0800',
                        });
                    }
                    $('#spinner0').hide();
                },
                error: function (error) {
                    console.log(error)
                    $('#spinner0').hide();
                }
            });
        });
    })
</script>
{% endblock %}