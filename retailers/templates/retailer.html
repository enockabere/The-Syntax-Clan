{% extends 'base.html' %}
{% load static %}
{% block base %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="{% static 'plugins/Moment/moment.js' %}"></script>
<link rel="stylesheet"
    href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
<section class="section">
    <div class="section-header">
        <h1>Retail Veterinary Pharmacy Permit Application Form</h1>
        <div class="section-header-breadcrumb">
            <div class="breadcrumb-item active"><a href="{% url 'dashboard' %}">Dashboard</a></div>
            <div class="breadcrumb-item"><a href="#">New Application</a></div>
            <div class="breadcrumb-item">New Applications</div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            {% include 'alert.html' %}
            <form id="regForm" class="bg-white p-4" method="post">
                {% csrf_token %}
                <input type="hidden" name="retailDealersNo" id="retailDealersNo" value="">
                <input type="hidden" name="myAction" id="myAction" value="insert">
                <div class="border border-success rounded p-3 my-3">
                    <p class="text-small text-primary">General Information</p>
                    <div class="row my-2">
                        <div class="col-md-8">
                            <label class="form-label">Premise Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="premiseName" id="premiseName">
                            <div id="premiseNameerror" style="color: red; display: none;">required field</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Town <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="town" id="town">
                            <div id="townerror" style="color: red; display: none;">required field</div>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-md-4">
                            <label class="form-label">Road <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="road" id="road">
                            <div id="roaderror" style="color: red; display: none;">required field</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Building <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="building" id="building">
                            <div id="buildingerror" style="color: red; display: none;">required field</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Plot No</label>
                            <input type="text" class="form-control" name="plotNo" id="plotNo">
                            <div id="plotNoerror" style="color: red; display: none;">required field</div>
                        </div>
                    </div>
                </div>
                <div class="border border-success rounded p-3 my-3">
                    <p class="text-small text-primary">Supervising Veterinary Information</p>
                    <div class="row my-3">
                        <div class="col-md-4">
                            <label class="form-label">Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="name" id="name">
                            <div id="nameerror" style="color: red; display: none;">required field</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Professional RegNo <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="professionalRegNo" id="professionalRegNo">
                            <div id="professionalRegNoerror" style="color: red; display: none;">required field</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Email<span class="text-danger">*</span></label>
                            <input type="email" class="form-control" name="email" id="email">
                            <div id="emailerror" style="color: red; display: none;">required field</div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Cell Phone <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" name="cellPhone" id="cellPhone">
                            <div id="cellPhoneerror" style="color: red; display: none;">required field</div>
                            <div id="ten_digit_error" style="color: red; display: none;">Must be 10 digits (07
                                XXXXXXX)
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Alternative Cell Phone (07 XXXXXXX)</label>
                            <input type="number" class="form-control" name="alternative_cellPhone"
                                id="alternative_cellPhone">
                            <div id="alternative_digit_error" style="color: red; display: none;">Must be 10 digits
                                (07
                                XXXXXXX)
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Qualification <span class="text-danger">*</span></label>
                            <select class="form-control" aria-label="Default select example" name="qualification"
                                id="qualification">
                                <option selected value="">--Select Qualification--</option>
                                {% for qualification in qualifications %}
                                <option value="{{qualification.ProposedCategory}}">
                                    {{qualification.ProposedCategory}} : {{qualification.Description}}</option>
                                {% endfor %}
                            </select>
                            <div id="qualificationError" style="color: red; display: none;">required field</div>
                        </div>
                    </div>
                </div>
                <div class="border border-success rounded p-3 my-3">
                    <p class="text-small text-primary">Applicant's' Information</p>
                    <div class="row my-3">
                        <div class="col-md-6">
                            <label class="form-label">Applicant Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="applicantName" id="applicantName">
                            <div id="applicantNameerror" style="color: red; display: none;">required field</div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Application Year <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" name="application_year" id="application_year"
                                min="2024" value="2024">
                            <div id="application_year_error" style="color: red; display: none;">The application year
                                starts
                                from 2024
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">First Time Application <span class="text-danger">*</span></label>
                            <select class="form-control" aria-label="Default select example" name="firstTimeApplication"
                                id="firstTimeApplication">
                                <option value="0" selected>--select--</option>
                                <option value="1">Yes</option>
                                <option value="2">No</option>
                            </select>
                            <div id="firstTimeApplicationerror" style="color: red; display: none;">required field
                            </div>
                        </div>
                    </div>
                    <div class="row my-2" style="display: none;" id="inspectionNoRow">
                        <div class="col-md-12">
                            <label class="form-label">Previous Inspection <span class="text-danger">*</span></label>
                            <select class="form-control" aria-label="Default select example" name="inspectionNo"
                                id="inspectionNo" disabled>
                                <option selected value="" disabled>--select--</option>
                                {% for inspection in Approved_Inspection %}
                                <option value="{{inspection.PremiseInpectionNo}}">
                                    {{inspection.CompanyName}}</option>
                                {% endfor %}
                            </select>
                            <div id="inspectionNoerror" style="color: red; display: none;">required field</div>
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-md-12">
                            <div class="mb-2">
                                <div class="form-group">
                                    <label class="custom-switch mt-2">
                                        <input type="checkbox" value="True" name="iAgree" id="iAgree"
                                            class="custom-switch-input" checked>
                                        <span class="custom-switch-indicator"></span>
                                        <span class="custom-switch-description">
                                            I hereby apply for a retail dealer permit and
                                            declare that all the information herein is correct
                                            and true.
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary my-3 w-100">Save Application</button>
            </form>
        </div>
    </div>
</section>

<script>
    const $headerForm = $('#regForm');

    $(document).ready(function () {
        $('#application_year').on('change', function () {
            var inputValue = $(this).val();
            if (inputValue < 2024) {
                $(this).css('border', '1px solid red');
                $(this).val(2024);
                $('#application_year_error').show();
            } else {
                $(this).css('border', '');
                $('#application_year_error').hide();
            }
        });
        $('#cellPhone').on('input', function () {
            let inputValue = $(this).val();
            if (inputValue.length > 10) {
                $(this).css('border', '1px solid red');
                $(this).val(inputValue.slice(0, 10));
                $('#ten_digit_error').show();
            } else {
                $(this).css('border', '');
                $('#ten_digit_error').hide();
            }
        });

        $('#cellPhone').on('blur', function () {
            let inputValue = $(this).val();
            if (inputValue.length < 10) {
                $(this).css('border', '1px solid red');
                $(this).val('');
                iziToast.show({
                    theme: 'dark',
                    icon: 'las la-exclamation',
                    title: "The Cell Phone number cannot be less than 10 digits",
                    position: 'topRight',
                    backgroundColor: '#E74C3C',
                    progressBarColor: '#FFFFFF',
                });
                $('#cellPhoneerror').show();
            } else {
                $(this).css('border', '');
                $('#cellPhoneerror').hide();
            }
        });

        $('#alternative_cellPhone').on('input', function () {
            let inputValue = $(this).val();
            if (inputValue.length > 10) {
                $(this).css('border', '1px solid red');
                $(this).val(inputValue.slice(0, 10));
                $('#alternative_digit_error').show();
            } else {
                $(this).css('border', '');
                $('#alternative_digit_error').hide();
            }
        });

        $('#alternative_cellPhone').on('blur', function () {
            let inputValue = $(this).val();
            if (inputValue.length < 10) {
                $(this).css('border', '1px solid blue');
                $(this).val('');
            } else {
                $(this).css('border', '');
            }
        });

        $('#firstTimeApplication').on('change', function () {
            if (this.value == '2') {
                $('#inspectionNoRow').show(700);
                $('#inspectionNo').prop('disabled', false);
            } else {
                $('#inspectionNoRow').hide(300);
                $('#inspectionNo').prop('disabled', true);
            }
        });
        $headerForm.on('submit', (e) => {
            e.preventDefault();
            let name = document.getElementById("name")
            name.style.border = "1px solid #28a745"
            let premiseName = document.getElementById("premiseName")
            premiseName.style.border = "1px solid #28a745"
            let town = document.getElementById("town")
            town.style.border = "1px solid #28a745"
            let road = document.getElementById("road")
            road.style.border = "1px solid #28a745"
            let building = document.getElementById("building")
            building.style.border = "1px solid #28a745"
            let plotNo = document.getElementById("plotNo")
            plotNo.style.border = "1px solid #28a745"
            let applicantName = document.getElementById("applicantName")
            applicantName.style.border = "1px solid #28a745"
            let firstTimeApplication = document.getElementById("firstTimeApplication")
            firstTimeApplication.style.border = "1px solid #28a745"
            let professionalRegNo = document.getElementById("professionalRegNo")
            professionalRegNo.style.border = "1px solid #28a745"
            let email = document.getElementById("email")
            email.style.border = "1px solid #28a745"
            let cellPhone = document.getElementById("cellPhone")
            cellPhone.style.border = "1px solid #28a745"
            let qualification = document.getElementById("qualification")
            qualification.style.border = "1px solid #28a745"

            let nameerror = document.getElementById("nameerror")
            nameerror.style.display = "none"
            let premiseNameerror = document.getElementById("premiseNameerror")
            premiseNameerror.style.display = "none"
            let townerror = document.getElementById("townerror")
            townerror.style.display = "none"
            let roaderror = document.getElementById("roaderror")
            roaderror.style.display = "none"
            let buildingerror = document.getElementById("buildingerror")
            buildingerror.style.display = "none"
            let plotNoerror = document.getElementById("plotNoerror")
            plotNoerror.style.display = "none"
            let applicantNameerror = document.getElementById("applicantNameerror")
            applicantNameerror.style.display = "none"
            let firstTimeApplicationerror = document.getElementById("firstTimeApplicationerror")
            firstTimeApplicationerror.style.display = "none"
            let professionalRegNoerror = document.getElementById("professionalRegNoerror")
            professionalRegNoerror.style.display = "none"
            let emailerror = document.getElementById("emailerror")
            emailerror.style.display = "none"
            let cellPhoneerror = document.getElementById("cellPhoneerror")
            cellPhoneerror.style.display = "none"
            let qualificationError = document.getElementById("qualificationError")


            if ($('#name').val() === '') {
                name.style.border = "1px solid red"
                nameerror.style.display = "block"
                return false
            } else if ($('#premiseName').val() === '') {
                premiseName.style.border = "1px solid red"
                premiseNameerror.style.display = "block"
                return false;
            } else if ($('#town').val() === '') {
                town.style.border = "1px solid red"
                townerror.style.display = "block"
                return false
            } else if ($('#road').val() === '') {
                road.style.border = "1px solid red"
                roaderror.style.display = "block"
                return false
            } else if ($('#building').val() === '') {
                building.style.border = "1px solid red"
                buildingerror.style.display = "block"
                return false
            } else if ($('#plotNo').val() === '') {
                plotNo.style.border = "1px solid red"
                plotNoerror.style.display = "block"
                return false
            } else if ($('#professionalRegNo').val() === '') {
                professionalRegNo.style.border = "1px solid red"
                professionalRegNoerror.style.display = "block"
                return false
            } else if ($('#firstTimeApplication').val() === '0') {
                firstTimeApplication.style.border = "1px solid red"
                firstTimeApplicationerror.style.display = "block"
                return false
            } else if ($('#email').val() === '') {
                email.style.border = "1px solid red"
                emailerror.style.display = "block"
                return false
            } else if ($('#cellPhone').val() === '') {
                cellPhone.style.border = "1px solid red"
                cellPhoneerror.style.display = "block"
                return false
            } else if ($('#applicantName').val() === '') {
                applicantName.style.border = "1px solid red"
                applicantNameerror.style.display = "block"
                return false
            } else if ($('#qualification').val() === "") {
                qualification.style.border = "1px solid red"
                qualificationError.style.display = "block"
            }
            $.ajax({
                type: 'POST',
                url: '/selfservice/retailer/permit/',
                data: {
                    retailDealersNo: $("#retailDealersNo").val(),
                    premiseName: $('#premiseName').val(),
                    town: $('#town').val(),
                    road: $('#road').val(),
                    building: $('#building').val(),
                    firstTimeApplication: $('#firstTimeApplication').val(),
                    inspectionNo: $('#inspectionNo').val(),
                    applicantName: $('#applicantName').val(),
                    iAgree: $('#iAgree').val(),
                    myAction: $("#myAction").val(),
                    name: $('#name').val(),
                    professionalRegNo: $('#professionalRegNo').val(),
                    email: $('#email').val(),
                    cellPhone: $('#cellPhone').val(),
                    qualification: $('#qualification').val(),
                    plotNo: $('#plotNo').val(),
                    application_year: $('#application_year').val(),
                    alternative_cellPhone: $('#alternative_cellPhone').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (response) {
                    if (response['response']) {
                        window.location.href = "/selfservice/retailer/" + response[
                                'response'] +
                            "/";
                        iziToast.show({
                            theme: 'dark',
                            backgroundColor: '#0974bd',
                            icon: 'las la-check-circle',
                            title: response['response'] +
                                " " +
                                "created successfully",
                            position: 'topRight',
                            progressBarColor: '#F4F6F7',
                        });
                        $('#premiseName, #name, #application_year, #alternative_cellPhone')
                            .val('');
                        $('#town,#professionalRegNo,#firstTimeApplication').val('');
                        $('#road,#cellPhone, #building, #proposedCategory').val('');
                        $('#applicantName,#qualification, #email, #plotNo').val('');
                    } else if (response['error']) {
                        iziToast.show({
                            theme: 'dark',
                            icon: 'las la-exclamation',
                            title: 'Error',
                            message: response['error'],
                            position: 'topRight',
                            progressBarColor: '#ff0800',
                        });
                    }
                },
                error: function (error) {
                    console.log(error)

                }
            });
        });
    })
</script>
{% endblock %}