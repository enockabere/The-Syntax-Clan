{% extends 'base.html' %}
{% load static %}
{% block base %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="{% static 'plugins/Moment/moment.js' %}"></script>
<link rel="stylesheet"
    href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">

<section class="section">
    <div class="section-header">
        <h1>Bulk Retention Application Form</h1>
        <div class="section-header-breadcrumb">
            <div class="breadcrumb-item active"><a href="{% url 'dashboard' %}">Dashboard</a></div>
            <div class="breadcrumb-item">New Application</div>
        </div>
    </div>
    <div class="section-body" id="main">
        <div class="row bg-white">
            <div class="col-md-12">
                {% include 'alert.html' %}
                <form id="regForm" class="bg-white px-4" method="post" novalidate>
                    {% csrf_token %}
                    <input type="hidden" name="retNo" id="retNo" value="">
                    <input type="hidden" name="myAction" id="myAction" value="insert">
                    <div class="border border-success rounded p-3 my-3">
                        <p class="text-small text-primary">General Details</p>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Veterinary Class <span class="text-danger">*</span></label>
                                <select class="form-control" aria-label="Default select example" name="veterinaryClass"
                                    id="veterinaryClass">
                                    <option selected value="0" disabled>--select--</option>
                                    {% for class in VertinaryClasses %}
                                    {% if class.Retention_Payable == True %}
                                    <option value="{{class.Class}}">
                                        {{class.Description}} - ( Payable )</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Year Of Retention <span class="text-danger">*</span></label>
                                <select class="form-control" aria-label="Default select example" name="yearOfRetention"
                                    id="yearOfRetention">
                                    <option selected value="0" disabled>--select--</option>
                                    {% for year in years %}
                                    <option value="{{year.Year}}">
                                        {{year.Year}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                    </div>
                    <div class="border border-success rounded p-3 my-3">
                        <p class="text-small text-primary">Applicant's' Information</p>
                        <div class="row my-3 gx-1">
                            <div class="col-md-8">
                                <label class="form-label">Applicant Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="signatoryName" id="signatoryName">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Position in the Company <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="signatoryPosition" id="signatoryPosition">
                            </div>
                        </div>
                        <div class="row my-2">
                            <div class="col-md-12">
                                <div class="mb-2">
                                    <div class="form-group">
                                        <label class="custom-switch mt-2">
                                            <input type="checkbox" value="True" name="iAgree" id="iAgree"
                                                class="custom-switch-input" checked>
                                            <span class="custom-switch-indicator"></span>
                                            <span class="custom-switch-description">
                                                I hereby apply for product retention and
                                                declare that all the information herein is correct
                                                and true.
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="money-spinner mx-auto text-center" id="spinner0" style="display: none;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif"
                            alt="Loading Gif" style="height: 70px; width: 100px;" class="img-fluid">
                    </div>
                    <button type="submit" class="btn btn-primary my-3 w-100">Save Application</button>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
    const $headerForm = $('#regForm');

    $(document).ready(function () {
        $headerForm.on('submit', (e) => {
            e.preventDefault();
            $('#spinner0').show();
            $.ajax({
                type: 'POST',
                url: '/selfservice/BulkRetention/',
                data: {
                    retNo: $("#retNo").val(),
                    signatoryName: $('#signatoryName').val(),
                    veterinaryClass: $('#veterinaryClass').val(),
                    signatoryPosition: $('#signatoryPosition').val(),
                    yearOfRetention: $('#yearOfRetention').val(),
                    iAgree: $('#iAgree').val(),
                    myAction: $("#myAction").val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (response) {
                    if (response['response']) {
                        window.location.href = "/selfservice/bulk/" + response[
                            'response'] + "/";
                        iziToast.show({
                            theme: 'dark',
                            backgroundColor: '#0974bd',
                            icon: 'las la-check-circle',
                            title: response['response'] +
                                " " +
                                "created successfully",
                            position: 'topRight',
                            progressBarColor: '#F4F6F7',
                        });
                        $('#yearOfRetention').val('');
                        $('#signatoryPosition').val('');
                        $('#signatoryName,#veterinaryClass').val('');
                    } else if (response['error']) {
                        iziToast.show({
                            theme: 'dark',
                            icon: 'las la-exclamation',
                            title: 'Error',
                            message: response['error'],
                            position: 'topRight',
                            progressBarColor: '#ff0800',
                        });
                    }
                    $('#spinner0').hide();
                },
                error: function (error) {
                    $('#spinner0').hide();
                    console.log(error)
                }
            });
        });
    })
</script>
{% endblock %}